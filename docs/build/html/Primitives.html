

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Primitives &mdash; SCALES-DRP 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Data Products" href="Data%20Products.html" />
    <link rel="prev" title="Running the SCALES-DRP Pipeline" href="Running%20the%20SCALES-DRP%20Pipeline.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            SCALES-DRP
              <img src="_static/logo1.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installing.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Quick%20Start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration%20Parameters.html">Configuration Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running%20the%20SCALES-DRP%20Pipeline.html">Running the <strong>SCALES-DRP</strong> Pipeline</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Primitives</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#rampfit">RampFit</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subtractoverscan">SubtractOverscan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trimoverscan">TrimOverscan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#makemasterbias">MakeMasterBias</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flagsaturation">FlagSaturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flatfielding">FlatFielding</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subtractbias">SubtractBias</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correctgain">CorrectGain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimalextract">OptimalExtract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#leastextract">LeastExtract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skysubtraction">SkySubtraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wavecalib">Wavecalib</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Products.html">Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="Mode%20of%20Pipelines.html">Modes of Pipeline Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="Versions.html">Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Updating%20Documentation.html">Updating Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Updating%20Documentation.html#updating-text">Updating text</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SCALES-DRP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Primitives</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Primitives.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="primitives">
<h1>Primitives<a class="headerlink" href="#primitives" title="Link to this heading"></a></h1>
<p>This section gives a brief idea about all the primitives used for <strong>SCALES-DRP</strong> pipeline.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#rampfit" id="id4">RampFit</a></p></li>
<li><p><a class="reference internal" href="#subtractoverscan" id="id5">SubtractOverscan</a></p></li>
<li><p><a class="reference internal" href="#trimoverscan" id="id6">TrimOverscan</a></p></li>
<li><p><a class="reference internal" href="#makemasterbias" id="id7">MakeMasterBias</a></p></li>
<li><p><a class="reference internal" href="#flagsaturation" id="id8">FlagSaturation</a></p></li>
<li><p><a class="reference internal" href="#flatfielding" id="id9">FlatFielding</a></p></li>
<li><p><a class="reference internal" href="#subtractbias" id="id10">SubtractBias</a></p></li>
<li><p><a class="reference internal" href="#correctgain" id="id11">CorrectGain</a></p></li>
<li><p><a class="reference internal" href="#optimalextract" id="id12">OptimalExtract</a></p></li>
<li><p><a class="reference internal" href="#leastextract" id="id13">LeastExtract</a></p></li>
<li><p><a class="reference internal" href="#skysubtraction" id="id14">SkySubtraction</a></p></li>
<li><p><a class="reference internal" href="#wavecalib" id="id15">Wavecalib</a></p></li>
</ul>
</nav>
<section id="rampfit">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">RampFit</a><a class="headerlink" href="#rampfit" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Generate an exposure from a ‘N’ number of user defined reads or group of ramps.</strong></p>
<p>We adopt the ramp fitting method of  <a class="reference external" href="https://github.com/t-brandt/fitramp/tree/main">Brandt et. al. 2024</a> for reads greater than 5. This method perform an optimal fit to a pixel’s count rate nondestructively in the presence of both read and photon noise. The method construct a covarience matrix by estimating the difference in the read in a ramp, propagation of the read noise, photon noise and their corelation. And Performs a generalized least squares fit to the differences, using the inverse of the covariance matrix as weights. This gives optimal weight to each difference. The readnoise per pixel is estimated from the <code class="docutils literal notranslate"><span class="pre">drak</span> <span class="pre">frames</span></code>. The jumps are detected iteratively checking the goodness of fit at each possible jump location. More details are presented in the <a class="reference external" href="https://iopscience.iop.org/article/10.1088/1538-3873/ad38d9/pdf">papers</a>.</p>
<p>In the case of reads less than 5, we do an iterative stright line fit to the data after correcting the read noise to estimate the slope image.</p>
</div></blockquote>
</section>
<section id="subtractoverscan">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">SubtractOverscan</a><a class="headerlink" href="#subtractoverscan" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Determines overscan offset and subtracts it from the image.</strong></p>
<p>Uses the BIASSEC header keyword to determine where to calculate the overscan
offset.  Subtracts the overscan offset and records the value in the header.
In addition, performs a polynomial fit and uses the residuals to determine
the read noise in the overscan.  Records the overscan readnoise in the
header as well.</p>
</div></blockquote>
</section>
<section id="trimoverscan">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">TrimOverscan</a><a class="headerlink" href="#trimoverscan" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Trim overscan region from image.</strong></p>
<p>Uses the data section (DSECn header keyword) to determine how to trim the
image to exclude the overscan region.</p>
<p>Removes raw section keywords, ASECn, BSECn, CSECn, and DSECn after trimming
and replaces them with the ATSECn keyword giving the image section in the
trimmed image for each amplifier.</p>
<p>If the input image is a bias frames, writes out a *_intb.fits file,
otherwise, just updates the image in the returned arguments.</p>
</div></blockquote>
</section>
<section id="makemasterbias">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">MakeMasterBias</a><a class="headerlink" href="#makemasterbias" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Stack bias frames into a master bias frame.</strong></p>
<p>Generate a master bias image from overscan-subtracted and trimmed bias
frames (*_intb.fits) based on the instrument config parameter
bias_min_nframes, which defaults to 7.  The combine method for biases is
‘average’ and so cosmic rays may be present, especially in RED channel data.
A high sigma clipping of 2.0 is used to help with the CRs.
Uses the ccdproc.combine routine to perform the stacking.</p>
<p>Writes out a *_mbias.fits file and records a master bias frame in the proc table.</p>
</div></blockquote>
</section>
<section id="flagsaturation">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">FlagSaturation</a><a class="headerlink" href="#flagsaturation" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Flag saturated pixels.</strong></p>
<p>Currently flags pixels with values &gt; 60,000 counts with a value of 8
in the flags FITS extension and updates the following FITS header keywords:</p>
<blockquote>
<div><ul class="simple">
<li><p>SATFLAG: set to <code class="docutils literal notranslate"><span class="pre">True</span></code> if operation is performed.</p></li>
<li><p>NSATFLAG: set to the count of saturated pixels.</p></li>
</ul>
</div></blockquote>
<p>Updates the flag extension of the image in the returned arguments. Similarly <code class="docutils literal notranslate"><span class="pre">hot</span> <span class="pre">pixels</span></code> and <code class="docutils literal notranslate"><span class="pre">cold</span> <span class="pre">pixels</span></code>  are identified and masked by searching the pixels brighter/dimmer than the local median value. The <code class="docutils literal notranslate"><span class="pre">noisy</span> <span class="pre">pixels</span></code> are identified by calculating the standard deviation over time for each pixel. Pixels with unusually high temporal standard deviation are flagged.</p>
</div></blockquote>
</section>
<section id="flatfielding">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">FlatFielding</a><a class="headerlink" href="#flatfielding" title="Link to this heading"></a></h2>
<blockquote>
<div><p>Working on</p>
</div></blockquote>
</section>
<section id="subtractbias">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">SubtractBias</a><a class="headerlink" href="#subtractbias" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Subtract the master bias frame.</strong></p>
<p>Reads in the master bias created by <code class="docutils literal notranslate"><span class="pre">MakeMasterBias</span></code> and performs the
subtraction (after verifying amplifier configuration agreement).  Records
the processing in the header.</p>
</div></blockquote>
</section>
<section id="correctgain">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">CorrectGain</a><a class="headerlink" href="#correctgain" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Convert raw data numbers to electrons.</strong></p>
<p>Uses the ATSECn FITS header keywords to divide image into amp regions and
then corrects each region with the corresponding GAINn keyword.  Updates the
following FITS header keywords:</p>
<blockquote>
<div><ul class="simple">
<li><p>GAINCOR: sets to <code class="docutils literal notranslate"><span class="pre">True</span></code> if operation performed.</p></li>
<li><p>BUNIT: sets to <cite>electron</cite>.</p></li>
<li><p>HISTORY: records the operation.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="optimalextract">
<span id="id1"></span><h2><a class="toc-backref" href="#id12" role="doc-backlink">OptimalExtract</a><a class="headerlink" href="#optimalextract" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Generate a 3D datacube with wavelength as third axis.</strong></p>
<p>Read the bias and flat corrected raw data and perform an ‘optimal’ extract
to generate the datacube using the weighted rectification matrix generated during daytime calibration.</p>
<p>User can choose to perform <code class="docutils literal notranslate"><span class="pre">optimalExtract</span></code> or <code class="docutils literal notranslate"><span class="pre">LeastExtract</span></code> based on the requirements.</p>
</div></blockquote>
</section>
<section id="leastextract">
<span id="id2"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink">LeastExtract</a><a class="headerlink" href="#leastextract" title="Link to this heading"></a></h2>
<blockquote>
<div><p><strong>Generate a 3D datacube with wavelength as third axis.</strong></p>
<p>Read the bias and flat corrected raw data and perform a ‘chi-square’ extract
to generate the datacube with the help of a rectification matrix created using the
daytime wavelength calibration.</p>
<p>User can choose to perform <code class="docutils literal notranslate"><span class="pre">optimalExtract</span></code> or  <code class="docutils literal notranslate"><span class="pre">LeastExtract</span></code> based on the requirements.</p>
</div></blockquote>
</section>
<section id="skysubtraction">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">SkySubtraction</a><a class="headerlink" href="#skysubtraction" title="Link to this heading"></a></h2>
<p>Working on</p>
</section>
<section id="wavecalib">
<span id="id3"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink">Wavecalib</a><a class="headerlink" href="#wavecalib" title="Link to this heading"></a></h2>
<p>Working on</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Running%20the%20SCALES-DRP%20Pipeline.html" class="btn btn-neutral float-left" title="Running the SCALES-DRP Pipeline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Data%20Products.html" class="btn btn-neutral float-right" title="Data Products" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, The SCALES Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>